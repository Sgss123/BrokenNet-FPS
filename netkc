#include "pch.h"
#include "CG3DTeapot.h"
#include "CGDI3DRenderContext.h"
#include "COGL3DRenderContext.h"
#include "CGDI3DCamera.h"
#include "COGL3DCamera.h"
#include "CGDI3DView.h"
#include "COGL3DView.h"
CG_NAMESPACE_ENTER
IMPLEMENT_SERIAL(CG3DTeapot, CG3DRenderable, 1)
CG3DTeapot::CG3DTeapot()
	: CG3DRenderable(CString("CG3DTeapot")), mSize(50)
{
	mName.Format(_T("茶壶-%ld"), sID);
}
CG3DTeapot::CG3DTeapot(double s)
	: CG3DRenderable(CString("CG3DTeapot")), mSize(s)
{
	mName.Format(_T("茶壶-%ld"), sID);
}
CG3DTeapot::CG3DTeapot(const CG3DTeapot& other)
	: CG3DRenderable(CString("CG3DTeapot")), mSize(other.mSize)
{
	mName.Format(_T("茶壶-%ld"), sID);
}
CG3DTeapot::~CG3DTeapot()
{
}
//序列化
void CG3DTeapot::Serialize(CArchive& ar)
{
	CG3DRenderable::Serialize(ar);
	if (ar.IsStoring())
	{
	}
	else
	{
	}
}

void CG3DTeapot::renderTeapot(GLfloat x, GLfloat y, GLfloat z,
   GLfloat ambr, GLfloat ambg, GLfloat ambb, GLfloat ambt,
   GLfloat difr, GLfloat difg, GLfloat difb, GLfloat dift,
   GLfloat specr, GLfloat specg, GLfloat specb, GLfloat spect,
   GLfloat shine)
{
   GLfloat mat[4];

   glPushMatrix();
   glTranslatef(x, y, z);
   mat[0] = ambr; mat[1] = ambg; mat[2] = ambb; mat[3] = ambt;
   glMaterialfv(GL_FRONT, GL_AMBIENT, mat);
   Appearance().Material()
   mat[0] = difr; mat[1] = difg; mat[2] = difb; mat[3] = dift;
   glMaterialfv(GL_FRONT, GL_DIFFUSE, mat);
   mat[0] = specr; mat[1] = specg; mat[2] = specb; mat[3] = spect;
   glMaterialfv(GL_FRONT, GL_SPECULAR, mat);
   glMaterialf(GL_FRONT, GL_SHININESS, shine);
   glutSolidTeapot(mSize);
   glPopMatrix();
}


void CG3DTeapot::Render(CGRenderContext* pRC, CGCamera* pCamera)
{
    if (pRC == nullptr || pRC->getView() == nullptr || pCamera == nullptr)
        return;
    if (pRC->IsKindOf(RUNTIME_CLASS(CGDI3DRenderContext)))
    {
        if (!pCamera->IsKindOf(RUNTIME_CLASS(CGDI3DCamera)))
            return;
    }
    else if (pRC->IsKindOf(RUNTIME_CLASS(COGL3DRenderContext)))
    {
        if (!pCamera->IsKindOf(RUNTIME_CLASS(COGL3DCamera)))
            return;
    }
    /*
    GLfloat ambient[] = { 0.0, 0.0, 0.0, 1.0 };
    GLfloat diffuse[] = { 1.0, 1.0, 1.0, 1.0 };
    GLfloat position[] = { 0.0, 3.0, 3.0, 0.0 };

    GLfloat lmodel_ambient[] = { 0.2, 0.2, 0.2, 1.0 };
    GLfloat local_view[] = { 0.0 };
    
    glLightfv(GL_LIGHT0, GL_AMBIENT, ambient);
    glLightfv(GL_LIGHT0, GL_DIFFUSE, diffuse);
    glLightfv(GL_LIGHT0, GL_POSITION, position);
    */
    //glLightModelfv(GL_LIGHT_MODEL_AMBIENT, lmodel_ambient);
    //glLightModelfv(GL_LIGHT_MODEL_LOCAL_VIEWER, local_view);
    
    glFrontFace(GL_CW);

   
   // glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
    
    /*
    *   首行:  黄铜、青铜、铬、金
    * 第二行:  翡翠、黑曜石、珍珠、红宝石
    * 第三行:  黄塑料、青塑料、黄橡胶、青橡胶
    */
    /* 第一行第一列绘制的茶壶：黄铜*/
	renderTeapot(-75.0, -50, 0.0,
        0.329412, 0.223529, 0.027451, 1.000000,
        0.780392, 0.568627, 0.113725, 1.000000,
        0.992157, 0.941176, 0.807843, 1.000000,
        27.897400);
    


    /* 第一行第二列绘制的茶壶：青铜*/
    renderTeapot(-25.0, -50, 0.0,
        0.212500, 0.127500, 0.054000, 1.000000,
        0.714000, 0.428400, 0.181440, 1.000000,
        0.393548, 0.271906, 0.166721, 1.000000,
        25.600000);
    



    /* 第一行第三列绘制的茶壶：铬*/
    renderTeapot(25.0, -50.0, 0.0,
        0.250000, 0.250000, 0.250000, 1.000000,
        0.400000, 0.400000, 0.400000, 1.000000,
        0.774597, 0.774597, 0.774597, 1.000000,
        76.800003);
    

    /* 第一行第四列绘制的茶壶：金*/
    renderTeapot(75.0, -50.0, 0.0,
        0.247250, 0.199500, 0.074500, 1.000000,
        0.751640, 0.606480, 0.226480, 1.000000,
        0.628281, 0.555802, 0.366065, 1.000000,
        51.200001);
    

    /* 第二行第一列绘制的茶壶：翡翠*/
    renderTeapot(-75.0, 0.0, 0.0,
        0.021500, 0.174500, 0.021500, 0.550000,
        0.075680, 0.614240, 0.075680, 0.550000,
        0.633000, 0.727811, 0.633000, 0.550000,
        76.800003);
    


    /* 第二行第二列绘制的茶壶：黑曜石*/
    renderTeapot(-25.0, 0.0, 0.0,
        0.053750, 0.050000, 0.066250, 0.820000,
        0.182750, 0.170000, 0.225250, 0.820000,
        0.332741, 0.328634, 0.346435, 0.820000,
        38.400002);
    


    /* 第二行第三列绘制的茶壶：珍珠*/
    renderTeapot(25.0, 0.0, 0.0,
        0.250000, 0.207250, 0.207250, 0.922000,
        1.000000, 0.829000, 0.829000, 0.922000,
        0.296648, 0.296648, 0.296648, 0.922000,
        11.264000);


    /* 第二行第四列绘制的茶壶：红宝石*/
    renderTeapot(75.0, 0.0, 0.0,
        0.174500, 0.011750, 0.011750, 0.550000,
        0.614240, 0.041360, 0.041360, 0.550000,
        0.727811, 0.626959, 0.626959, 0.550000,
        76.800003);
    


    /* 第三行第一列绘制的茶壶：黄塑料*/
    renderTeapot(-75.0, 50.0, 0.0,
        0.0, 0.0, 0.0, 1.000000,
        0.5, 0.5, 0.0, 1.000000,
        0.60, 0.60, 0.50, 1.000000,
        0.25);
    

    /* 第三行第二列绘制的茶壶：青塑料*/
    renderTeapot(-25.0, 50.0, 0.0,
        0.000000, 0.100000, 0.060000, 1.000000,
        0.000000, 0.509803, 0.509803, 1.000000,
        0.501960, 0.501960, 0.501960, 1.000000,
        0.250000);
    


    /* 第三行第三列绘制的茶壶：黄橡胶*/
    renderTeapot(25.0, 50.0, 0.0,
        0.050000, 0.050000, 0.000000, 1.000000,
        0.500000, 0.500000, 0.400000, 1.000000,
        0.700000, 0.700000, 0.040000, 1.000000,
        0.078125);
    


    /* 第三行第四列绘制的茶壶：青橡胶*/
    renderTeapot(75.0, 50, 0.0,
        0.000000, 0.050000, 0.050000, 1.000000,
        0.400000, 0.500000, 0.500000, 1.000000,
        0.040000, 0.700000, 0.700000, 1.000000,
        0.078125);
    

}
CG_NAMESPACE_EXIT